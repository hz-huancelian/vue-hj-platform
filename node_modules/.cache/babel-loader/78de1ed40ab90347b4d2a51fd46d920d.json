{"remainingRequest":"F:\\webstormProjectsJiu\\vue-hj-platform\\node_modules\\babel-loader\\lib\\index.js!F:\\webstormProjectsJiu\\vue-hj-platform\\node_modules\\cache-loader\\dist\\cjs.js??ref--0-0!F:\\webstormProjectsJiu\\vue-hj-platform\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!F:\\webstormProjectsJiu\\vue-hj-platform\\src\\views\\system\\factor\\factorList.vue?vue&type=script&lang=js&","dependencies":[{"path":"F:\\webstormProjectsJiu\\vue-hj-platform\\src\\views\\system\\factor\\factorList.vue","mtime":1650700631000},{"path":"F:\\webstormProjectsJiu\\vue-hj-platform\\babel.config.js","mtime":1637214064000},{"path":"F:\\webstormProjectsJiu\\vue-hj-platform\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"F:\\webstormProjectsJiu\\vue-hj-platform\\node_modules\\babel-loader\\lib\\index.js","mtime":315532800000},{"path":"F:\\webstormProjectsJiu\\vue-hj-platform\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"F:\\webstormProjectsJiu\\vue-hj-platform\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["\"use strict\";\n\nvar _interopRequireWildcard = require(\"F:\\\\webstormProjectsJiu\\\\vue-hj-platform\\\\node_modules\\\\@babel\\\\runtime\\\\helpers\\\\interopRequireWildcard.js\");\n\nvar _interopRequireDefault = require(\"F:\\\\webstormProjectsJiu\\\\vue-hj-platform\\\\node_modules\\\\@babel\\\\runtime\\\\helpers\\\\interopRequireDefault.js\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nvar _Pagination = _interopRequireDefault(require(\"@/components/Pagination\"));\n\nvar factorServer = _interopRequireWildcard(require(\"@/api/factor\"));\n\nvar dictServer = _interopRequireWildcard(require(\"@/api/dict\"));\n\nvar _axios = _interopRequireDefault(require(\"axios\"));\n\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nvar _default = {\n  components: {\n    Pagination: _Pagination.default\n  },\n  data: function data() {\n    return {\n      searchForm: {\n        classId: '',\n        factorName: '',\n        pageNumber: 1,\n        pageSize: 10\n      },\n      total: 0,\n      factorData: [],\n      factorDialogVisible: false,\n      categoryArray: [],\n      factorForm: {\n        id: '',\n        price: '',\n        cmaFlg: '',\n        cnasFlg: ''\n      },\n      extAssistFlg: '1',\n      factorRules: {\n        price: [{\n          required: true,\n          message: '单价信息不能不空',\n          trigger: 'blur'\n        }]\n      },\n      uploadVisible: false,\n      fileList: [],\n      classArray: []\n    };\n  },\n  created: function created() {\n    this.getClassList();\n    this.handleSearch();\n  },\n  methods: {\n    getClassList: function getClassList() {\n      var _this = this;\n\n      dictServer.findFstClasses().then(function (res) {\n        _this.classArray = res.result || [];\n      });\n    },\n    handleSearch: function handleSearch() {\n      var _this2 = this;\n\n      factorServer.getFactorListForPage(this.searchForm).then(function (res) {\n        if (res.code === 200) {\n          _this2.factorData = res.result.records || [];\n          _this2.total = res.result.total;\n        }\n      });\n    },\n    handleUpdate: function handleUpdate(row) {\n      this.factorForm.id = row.id;\n      this.factorForm.price = row.price;\n      this.factorForm.cmaFlg = row.cmaFlg;\n      this.factorForm.cnasFlg = row.cnasFlg;\n\n      if (this.factorForm.cmaFlg === '1' || this.factorForm.cnasFlg === '1') {\n        this.extAssistFlg = '0';\n      } else {\n        this.extAssistFlg = '1';\n      }\n\n      this.factorDialogVisible = true;\n    },\n    handleUpload: function handleUpload() {\n      this.fileList = [];\n      this.uploadVisible = true;\n    },\n    handleDownload: function handleDownload() {\n      var url = '/api/factor/export?sheetName=';\n      window.open(url);\n    },\n    confirmDialog: function confirmDialog() {\n      var _this3 = this;\n\n      this.$refs.factorForm.validate(function (valid) {\n        if (valid) {\n          factorServer.updateStandard(_this3.factorForm).then(function (request) {\n            _this3.$notify({\n              title: '成功',\n              message: request.message,\n              type: 'success'\n            });\n\n            _this3.handleSearch();\n\n            _this3.factorDialogVisible = false;\n\n            _this3.$refs.factorForm.resetFields();\n          });\n        } else {\n          return false;\n        }\n      });\n    },\n    handleChangeCMA: function handleChangeCMA(val) {\n      if (val === '0') {\n        this.factorForm.cnasFlg = '1';\n      } else {\n        this.factorForm.cnasFlg = '0';\n      }\n    },\n    handleChangeCNAS: function handleChangeCNAS(val) {\n      if (val === '0') {\n        this.factorForm.cmaFlg = '1';\n      } else {\n        this.factorForm.cmaFlg = '0';\n      }\n    },\n    handleChange: function handleChange(val) {\n      if (val === '1') {\n        this.factorForm.cmaFlg = '0';\n        this.factorForm.cnasFlg = '0';\n      }\n    },\n    onUploadChange: function onUploadChange(file) {\n      if (file.status === 'ready') return;\n\n      if (file.status === 'success') {\n        this.$message({\n          type: 'success',\n          message: '上传成功!'\n        });\n        this.uploadVisible = false;\n      } else {\n        this.$message.error('上传失败!');\n      }\n    },\n    onExceed: function onExceed() {\n      this.$message.error('最多上传一个文件');\n    },\n    uploadSectionFile: function uploadSectionFile(params) {\n      var _this4 = this;\n\n      var form = new FormData();\n      form.append('file', params.file);\n\n      _axios.default.post('/api/factor/importExcel', form, {\n        responseType: 'arraybuffer'\n      }).then(function (res) {\n        _this4.$message({\n          type: 'success',\n          message: '上传成功!'\n        });\n\n        _this4.handleSearch();\n\n        if (res.data.byteLength > 0) {\n          var a = document.createElement('a');\n          var blob = new Blob([res.data]);\n          var objectUrl = URL.createObjectURL(blob);\n          a.setAttribute('href', objectUrl);\n          a.setAttribute('download', '异常处理返回.xls');\n          a.click(); // console.log(objectUrl);\n\n          URL.revokeObjectURL(objectUrl); // 释放内存\n        }\n\n        _this4.uploadVisible = false;\n      }).catch(function (res) {\n        console.log(res);\n      });\n    }\n  }\n};\nexports.default = _default;",{"version":3,"sources":["factorList.vue"],"names":[],"mappings":"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","sourcesContent":["<template>\n  <div class=\"app-container\">\n    <div>\n      <el-form :model=\"searchForm\" :inline=\"true\">\n        <el-row>\n          <el-col :span=\"18\">\n            <el-form-item label=\"检测对象:\">\n              <el-select v-model=\"searchForm.classId\" clearable style=\"width:175px\" filterable placeholder=\"检测对象\">\n                <el-option\n                  v-for=\"item in classArray\"\n                  :key=\"item.id\"\n                  :label=\"item.name\"\n                  :value=\"item.id\"\n                />\n              </el-select>\n            </el-form-item>\n            <el-form-item label=\"检测因子:\">\n              <el-input v-model=\"searchForm.factorName\" style=\"width:175px\" placeholder=\"检测因子\" />\n            </el-form-item>\n            <el-form-item>\n              <el-button type=\"primary\" class=\"iconfont icon-chaxun1\" @click=\"handleSearch\"> 查询</el-button>\n            </el-form-item>\n          </el-col>\n          <el-col :span=\"6\" class=\"search-right\">\n            <el-button type=\"text\" icon=\"el-icon-refresh\" @click=\"handleSearch\">刷新</el-button>\n            <el-button type=\"text\" icon=\"el-icon-upload\" @click=\"handleUpload\">上传</el-button>\n            <el-button type=\"text\" icon=\"el-icon-download\" @click=\"handleDownload\">导出</el-button>\n          </el-col>\n        </el-row>\n      </el-form>\n      <el-table\n        stripe\n        :data=\"factorData\"\n        highlight-current-row\n        :header-cell-style=\"{background:'#ECF3FC'}\"\n        border\n        style=\"width: 100%\"\n      >\n        <template slot=\"empty\">\n          <div class=\"table_empty\">\n            <div class=\"empty_tips\">\n              <span>\n                暂无因子\n              </span>\n            </div>\n          </div>\n        </template>\n        <el-table-column type=\"index\" width=\"55\" label=\"序号\" align=\"center\" />\n        <el-table-column prop=\"className\" label=\"检测对象\" align=\"center\" />\n        <el-table-column prop=\"factorName\" label=\"检测因子\" align=\"center\" />\n        <el-table-column prop=\"standardNo\" label=\"标准号\" align=\"center\" />\n        <el-table-column prop=\"standardName\" label=\"检测标准\" min-width=\"220px\" align=\"center\" />\n        <el-table-column prop=\"analysisMethod\" label=\"分析方法\" min-width=\"80px\" align=\"center\" />\n        <el-table-column label=\"标准状态\" min-width=\"80px\" align=\"center\">\n          <template slot-scope=\"{row}\">\n            {{ row.methodStatus === '0'?\"现行\":\"废弃\" }}\n          </template>\n        </el-table-column>\n\n        <el-table-column prop=\"factorUnit\" label=\"因子单位\" width=\"80px\" align=\"center\" />\n        <el-table-column prop=\"price\" label=\"检测费用\" align=\"center\" />\n        <el-table-column prop=\"cmaFlg\" label=\"CMA\" width=\"60px\" align=\"center\">\n          <template slot-scope=\"{row}\">\n            <el-tag :type=\"row.cmaFlg==='1'?'success':'danger'\">{{ row.cmaFlg==='1'?'Y':'N' }}</el-tag>\n          </template>\n        </el-table-column>\n        <el-table-column prop=\"cnasFlg\" label=\"CNAS\" width=\"60px\" align=\"center\">\n          <template slot-scope=\"{row}\">\n            <el-tag :type=\"row.cnasFlg==='1'?'success':'danger'\">{{ row.cnasFlg==='1'?'Y':'N' }}</el-tag>\n          </template>\n        </el-table-column>\n        <el-table-column prop=\"extAssistFlg\" label=\"检测能力\" width=\"80px\" align=\"center\">\n          <template slot-scope=\"{row}\">\n            <el-tag :type=\"(row.cmaFlg==='1'|| row.cnasFlg==='1')?'success':'danger'\">{{ (row.cmaFlg==='1'|| row.cnasFlg==='1')?'有':'无' }}</el-tag>\n          </template>\n        </el-table-column>\n\n        <el-table-column fixed=\"right\" align=\"center\" label=\"操作\">\n          <template slot-scope=\"scope\">\n            <el-button type=\"text\" @click=\"handleUpdate(scope.row)\"> 编辑</el-button>\n          </template>\n        </el-table-column>\n      </el-table>\n      <div style=\"float: right\">\n        <pagination\n          v-show=\"total>0\"\n          :total=\"total\"\n          :page.sync=\"searchForm.pageNumber\"\n          :limit.sync=\"searchForm.pageSize\"\n          @pagination=\"handleSearch\"\n        />\n      </div>\n\n      <el-dialog title=\"因子编辑\" :visible.sync=\"factorDialogVisible\" width=\"50%\">\n        <div style=\"width: 550px;margin:0 auto;\">\n          <el-form ref=\"factorForm\" :model=\"factorForm\" :rules=\"factorRules\" label-width=\"130px\">\n            <el-form-item prop=\"price\" label=\"检测费用:\">\n              <el-input v-model=\"factorForm.price\" placeholder=\"检测费用\" maxlength=\"10\" style=\"width: 70%;\" />\n            </el-form-item>\n            <el-form-item label=\"检测能力:\">\n              <el-select v-model=\"extAssistFlg\" default-first-option placeholder=\"检测能力\" @change=\"handleChange\">\n                <el-option value=\"0\" label=\"有能力\" />\n                <el-option value=\"1\" label=\"无能力\" />\n              </el-select>\n            </el-form-item>\n            <el-form-item v-if=\"extAssistFlg === '0'\" prop=\"cmaFlg\" label=\"CMA:\">\n              <el-radio-group v-model=\"factorForm.cmaFlg\">\n                <el-radio label=\"0\">无</el-radio>\n                <el-radio label=\"1\">有</el-radio>\n              </el-radio-group>\n            </el-form-item>\n            <el-form-item v-if=\"extAssistFlg === '0'\" prop=\"cnasFlg\" label=\"CNAS:\">\n              <el-radio-group v-model=\"factorForm.cnasFlg\">\n                <el-radio label=\"0\">无</el-radio>\n                <el-radio label=\"1\">有</el-radio>\n              </el-radio-group>\n            </el-form-item>\n          </el-form>\n        </div>\n        <div slot=\"footer\" class=\"dialog-footer\">\n          <el-button type=\"primary\" @click=\"factorDialogVisible=false\">取消</el-button>\n          <el-button type=\"primary\" @click=\"confirmDialog\">确认</el-button>\n        </div>\n      </el-dialog>\n\n      <el-dialog title=\"能力表上传\" :visible.sync=\"uploadVisible\">\n        <el-upload\n          ref=\"upload\"\n          class=\"upload-demo\"\n          action=\"/api/factor/importExcel\"\n          :on-change=\"onUploadChange\"\n          :on-exceed=\"onExceed\"\n          :limit=\"1\"\n          :file-list=\"fileList\"\n          :http-request=\"uploadSectionFile\"\n        >\n          <el-button size=\"small\" type=\"primary\">点击上传</el-button>\n          <div slot=\"tip\" class=\"el-upload__tip\" />\n        </el-upload>\n      </el-dialog>\n    </div>\n  </div>\n</template>\n\n<script>\nimport Pagination from '@/components/Pagination'\nimport * as factorServer from '@/api/factor'\nimport * as dictServer from '@/api/dict'\nimport axios from 'axios'\nexport default {\n  components: { Pagination },\n  data() {\n    return {\n      searchForm: {\n        classId: '',\n        factorName: '',\n        pageNumber: 1,\n        pageSize: 10\n      },\n      total: 0,\n      factorData: [],\n      factorDialogVisible: false,\n      categoryArray: [],\n      factorForm: {\n        id: '',\n        price: '',\n        cmaFlg: '',\n        cnasFlg: ''\n      },\n      extAssistFlg: '1',\n      factorRules: {\n        price: [{ required: true, message: '单价信息不能不空', trigger: 'blur' }]\n      },\n      uploadVisible: false,\n      fileList: [],\n      classArray: []\n    }\n  },\n  created() {\n    this.getClassList()\n    this.handleSearch()\n  },\n  methods: {\n    getClassList() {\n      dictServer.findFstClasses().then(res => {\n        this.classArray = res.result || []\n      })\n    },\n    handleSearch() {\n      factorServer.getFactorListForPage(this.searchForm).then(res => {\n        if (res.code === 200) {\n          this.factorData = res.result.records || []\n          this.total = res.result.total\n        }\n      })\n    },\n    handleUpdate(row) {\n      this.factorForm.id = row.id\n      this.factorForm.price = row.price\n      this.factorForm.cmaFlg = row.cmaFlg\n      this.factorForm.cnasFlg = row.cnasFlg\n      if (this.factorForm.cmaFlg === '1' || this.factorForm.cnasFlg === '1') {\n        this.extAssistFlg = '0'\n      } else {\n        this.extAssistFlg = '1'\n      }\n      this.factorDialogVisible = true\n    },\n    handleUpload() {\n      this.fileList = []\n      this.uploadVisible = true\n    },\n    handleDownload() {\n      var url = '/api/factor/export?sheetName='\n      window.open(url)\n    },\n    confirmDialog() {\n      this.$refs.factorForm.validate(valid => {\n        if (valid) {\n          factorServer.updateStandard(this.factorForm).then(request => {\n            this.$notify({\n              title: '成功',\n              message: request.message,\n              type: 'success'\n            })\n            this.handleSearch()\n            this.factorDialogVisible = false\n            this.$refs.factorForm.resetFields()\n          })\n        } else {\n          return false\n        }\n      })\n    },\n    handleChangeCMA(val) {\n      if (val === '0') {\n        this.factorForm.cnasFlg = '1'\n      } else {\n        this.factorForm.cnasFlg = '0'\n      }\n    },\n    handleChangeCNAS(val) {\n      if (val === '0') {\n        this.factorForm.cmaFlg = '1'\n      } else {\n        this.factorForm.cmaFlg = '0'\n      }\n    },\n    handleChange(val) {\n      if (val === '1') {\n        this.factorForm.cmaFlg = '0'\n        this.factorForm.cnasFlg = '0'\n      }\n    },\n    onUploadChange(file) {\n      if (file.status === 'ready') return\n      if (file.status === 'success') {\n        this.$message({\n          type: 'success',\n          message: '上传成功!'\n        })\n        this.uploadVisible = false\n      } else {\n        this.$message.error('上传失败!')\n      }\n    },\n    onExceed() {\n      this.$message.error('最多上传一个文件')\n    },\n    uploadSectionFile(params) {\n      const form = new FormData()\n      form.append('file', params.file)\n      axios.post('/api/factor/importExcel', form,\n        { responseType: 'arraybuffer' }).then((res) => {\n        this.$message({\n          type: 'success',\n          message: '上传成功!'\n        })\n        this.handleSearch()\n        if (res.data.byteLength > 0) {\n          const a = document.createElement('a')\n          const blob = new Blob([res.data])\n          const objectUrl = URL.createObjectURL(blob)\n          a.setAttribute('href', objectUrl)\n          a.setAttribute('download', '异常处理返回.xls')\n          a.click()\n          // console.log(objectUrl);\n          URL.revokeObjectURL(objectUrl) // 释放内存\n        }\n        this.uploadVisible = false\n      }).catch((res) => {\n        console.log(res)\n      })\n    }\n  }\n}\n</script>\n\n<style scoped lang=\"scss\" type=\"text/scss\">\n  .search_div {\n    >div {\n      &:nth-child(1){\n        margin-right: 10px;\n      }\n      display: inline-block;\n    }\n  }\n\n  .search_input {\n    width: 200px;\n    margin-bottom: 5px;\n  }\n  .search-right {\n    text-align: right;\n    padding-right: 25px;\n  }\n</style>\n"],"sourceRoot":"src/views/system/factor"}]}