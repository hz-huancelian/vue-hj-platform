{"remainingRequest":"F:\\webstormProjects\\vue-hj-platform\\node_modules\\babel-loader\\lib\\index.js!F:\\webstormProjects\\vue-hj-platform\\node_modules\\eslint-loader\\index.js??ref--13-0!F:\\webstormProjects\\vue-hj-platform\\src\\store\\modules\\user.js","dependencies":[{"path":"F:\\webstormProjects\\vue-hj-platform\\src\\store\\modules\\user.js","mtime":1652603142000},{"path":"F:\\webstormProjects\\vue-hj-platform\\babel.config.js","mtime":1637214064000},{"path":"F:\\webstormProjects\\vue-hj-platform\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"F:\\webstormProjects\\vue-hj-platform\\node_modules\\babel-loader\\lib\\index.js","mtime":315532800000},{"path":"F:\\webstormProjects\\vue-hj-platform\\node_modules\\eslint-loader\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nvar _user = require(\"@/api/user\");\n\nvar _auth = require(\"@/utils/auth\");\n\nvar _router = require(\"@/router\");\n\nvar state = {\n  token: (0, _auth.getToken)(),\n  name: '',\n  userId: '',\n  userInfo: '',\n  platformPositionId: '',\n  avatar: '',\n  introduction: '',\n  organId: '',\n  resetForm: '',\n  roles: [],\n  permissions: [],\n  sysBaseUrl: 'https://www.huancelian.com' // sysBaseUrl: 'http://182.92.73.87:9900'\n  // sysBaseUrl: 'http://8.136.159.136:8083'\n\n};\nvar mutations = {\n  SET_TOKEN: function SET_TOKEN(state, token) {\n    state.token = token;\n  },\n  SET_INTRODUCTION: function SET_INTRODUCTION(state, introduction) {\n    state.introduction = introduction;\n  },\n  SET_USERINFO: function SET_USERINFO(state, user) {\n    state.userInfo = user;\n    state.userId = user.userId;\n    state.platformPositionId = user.platformPositionId;\n  },\n  SET_AVATAR: function SET_AVATAR(state, avatar) {\n    state.avatar = avatar;\n  },\n  SET_ROLES: function SET_ROLES(state, roles) {\n    state.roles = roles;\n  },\n  SET_ORGAN: function SET_ORGAN(state, organId) {\n    state.organId = organId;\n  },\n  SET_RESETTYPE: function SET_RESETTYPE(state, type) {\n    state.resetForm = type;\n  },\n  SET_PERMISSIONS: function SET_PERMISSIONS(state, permissions) {\n    state.permissions = permissions;\n  }\n};\nvar actions = {\n  // user login\n  login: function login(_ref, userInfo) {\n    var commit = _ref.commit;\n    var username = userInfo.username,\n        password = userInfo.password;\n    return new Promise(function (resolve, reject) {\n      (0, _user.login)({\n        username: username.trim(),\n        password: password\n      }).then(function (response) {\n        var result = response.result;\n        commit('SET_TOKEN', result);\n        (0, _auth.setToken)(result);\n        resolve();\n      }).catch(function (error) {\n        reject(error);\n      });\n    });\n  },\n  phoneLogin: function phoneLogin(_ref2, userInfo) {\n    var commit = _ref2.commit;\n    var phone = userInfo.phone,\n        password = userInfo.password;\n    return new Promise(function (resolve, reject) {\n      (0, _user.phoneLogin)({\n        phone: phone.trim(),\n        password: password\n      }).then(function (response) {\n        var result = response.result;\n        commit('SET_TOKEN', result);\n        (0, _auth.setToken)(result);\n        resolve();\n      }).catch(function (error) {\n        reject(error);\n      });\n    });\n  },\n  // get user info\n  getInfo: function getInfo(_ref3) {\n    var commit = _ref3.commit,\n        state = _ref3.state;\n    return new Promise(function (resolve, reject) {\n      (0, _user.getInfo)(state.token).then(function (response) {\n        var result = response.result;\n\n        if (!result) {\n          reject('个人信息获取失败，请重新登录');\n        }\n\n        var avatarPath = result.avatarPath,\n            roles = result.roles,\n            organId = result.organId,\n            resources = result.resources;\n        debugger;\n\n        if (roles && roles.length > 0) {\n          // 验证返回的roles是否是一个非空数组\n          commit('SET_ROLES', roles);\n          commit('SET_PERMISSIONS', resources);\n        } else {\n          commit('SET_ROLES', ['ROLE_DEFAULT']);\n        }\n\n        commit('SET_ORGAN', organId);\n        commit('SET_USERINFO', result);\n        commit('SET_AVATAR', avatarPath);\n        resolve(result);\n      }).catch(function (error) {\n        reject(error);\n      });\n    });\n  },\n  // user logout\n  logout: function logout(_ref4) {\n    var commit = _ref4.commit,\n        state = _ref4.state,\n        dispatch = _ref4.dispatch;\n    return new Promise(function (resolve, reject) {\n      (0, _user.doLogout)(state.token).then(function () {\n        commit('SET_TOKEN', '');\n        commit('SET_ROLES', []);\n        commit('SET_PERMISSIONS', []);\n        (0, _auth.removeToken)();\n        (0, _router.resetRouter)();\n        dispatch('tagsView/delAllViews', null, {\n          root: true\n        });\n        resolve();\n      }).catch(function (error) {\n        reject(error);\n      });\n    });\n  },\n  resetAttrPath: function resetAttrPath(_ref5, path) {\n    var commit = _ref5.commit;\n    commit('SET_AVATAR', path);\n  },\n  // remove token\n  resetToken: function resetToken(_ref6) {\n    var commit = _ref6.commit;\n    return new Promise(function (resolve) {\n      commit('SET_TOKEN', '');\n      commit('SET_ROLES', []);\n      commit('SET_PERMISSIONS', []);\n      (0, _auth.removeToken)();\n      resolve();\n    });\n  },\n  resetCompForm: function resetCompForm(_ref7, type) {\n    var commit = _ref7.commit;\n    commit('SET_RESETTYPE', type);\n  },\n  // 前端 登出\n  FedLogOut: function FedLogOut(_ref8) {\n    var commit = _ref8.commit;\n    return new Promise(function (resolve) {\n      commit('SET_TOKEN', '');\n      (0, _auth.removeToken)();\n      resolve();\n    });\n  }\n};\nvar _default = {\n  namespaced: true,\n  state: state,\n  mutations: mutations,\n  actions: actions\n};\nexports.default = _default;",{"version":3,"sources":["F:/webstormProjects/vue-hj-platform/src/store/modules/user.js"],"names":["state","token","name","userId","userInfo","platformPositionId","avatar","introduction","organId","resetForm","roles","permissions","sysBaseUrl","mutations","SET_TOKEN","SET_INTRODUCTION","SET_USERINFO","user","SET_AVATAR","SET_ROLES","SET_ORGAN","SET_RESETTYPE","type","SET_PERMISSIONS","actions","login","commit","username","password","Promise","resolve","reject","trim","then","response","result","catch","error","phoneLogin","phone","getInfo","avatarPath","resources","length","logout","dispatch","root","resetAttrPath","path","resetToken","resetCompForm","FedLogOut","namespaced"],"mappings":"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","sourcesContent":["import { login, phoneLogin, doLogout, getInfo } from '@/api/user'\nimport { getToken, setToken, removeToken } from '@/utils/auth'\nimport { resetRouter } from '@/router'\n\nconst state = {\n  token: getToken(),\n  name: '',\n  userId: '',\n  userInfo: '',\n  platformPositionId: '',\n  avatar: '',\n  introduction: '',\n  organId: '',\n  resetForm: '',\n  roles: [],\n  permissions: [],\n  sysBaseUrl: 'https://www.huancelian.com'\n  // sysBaseUrl: 'http://182.92.73.87:9900'\n  // sysBaseUrl: 'http://8.136.159.136:8083'\n}\n\nconst mutations = {\n  SET_TOKEN: (state, token) => {\n    state.token = token\n  },\n  SET_INTRODUCTION: (state, introduction) => {\n    state.introduction = introduction\n  },\n  SET_USERINFO: (state, user) => {\n    state.userInfo = user\n    state.userId = user.userId\n    state.platformPositionId = user.platformPositionId\n  },\n  SET_AVATAR: (state, avatar) => {\n    state.avatar = avatar\n  },\n  SET_ROLES: (state, roles) => {\n    state.roles = roles\n  },\n  SET_ORGAN: (state, organId) => {\n    state.organId = organId\n  },\n  SET_RESETTYPE: (state, type) => {\n    state.resetForm = type\n  },\n  SET_PERMISSIONS: (state, permissions) => {\n    state.permissions = permissions\n  }\n}\n\nconst actions = {\n  // user login\n  login({ commit }, userInfo) {\n    const { username, password } = userInfo\n    return new Promise((resolve, reject) => {\n      login({ username: username.trim(), password: password }).then(response => {\n        const { result } = response\n        commit('SET_TOKEN', result)\n        setToken(result)\n        resolve()\n      }).catch(error => {\n        reject(error)\n      })\n    })\n  },\n  phoneLogin({ commit }, userInfo) {\n    const { phone, password } = userInfo\n    return new Promise((resolve, reject) => {\n      phoneLogin({ phone: phone.trim(), password: password }).then(response => {\n        const { result } = response\n        commit('SET_TOKEN', result)\n        setToken(result)\n        resolve()\n      }).catch(error => {\n        reject(error)\n      })\n    })\n  },\n  // get user info\n  getInfo({ commit, state }) {\n    return new Promise((resolve, reject) => {\n      getInfo(state.token).then(response => {\n        const { result } = response\n        if (!result) {\n          reject('个人信息获取失败，请重新登录')\n        }\n\n        const { avatarPath, roles, organId, resources } = result\n        debugger\n        if (roles && roles.length > 0) { // 验证返回的roles是否是一个非空数组\n          commit('SET_ROLES', roles)\n          commit('SET_PERMISSIONS', resources)\n        } else {\n          commit('SET_ROLES', ['ROLE_DEFAULT'])\n        }\n        commit('SET_ORGAN', organId)\n        commit('SET_USERINFO', result)\n        commit('SET_AVATAR', avatarPath)\n        resolve(result)\n      }).catch(error => {\n        reject(error)\n      })\n    })\n  },\n\n  // user logout\n  logout({ commit, state, dispatch }) {\n    return new Promise((resolve, reject) => {\n      doLogout(state.token).then(() => {\n        commit('SET_TOKEN', '')\n        commit('SET_ROLES', [])\n        commit('SET_PERMISSIONS', [])\n        removeToken()\n        resetRouter()\n        dispatch('tagsView/delAllViews', null, { root: true })\n\n        resolve()\n      }).catch(error => {\n        reject(error)\n      })\n    })\n  },\n  resetAttrPath({ commit }, path) {\n    commit('SET_AVATAR', path)\n  },\n  // remove token\n  resetToken({ commit }) {\n    return new Promise(resolve => {\n      commit('SET_TOKEN', '')\n      commit('SET_ROLES', [])\n      commit('SET_PERMISSIONS', [])\n      removeToken()\n      resolve()\n    })\n  },\n  resetCompForm({ commit }, type) {\n    commit('SET_RESETTYPE', type)\n  },\n  // 前端 登出\n  FedLogOut({ commit }) {\n    return new Promise(resolve => {\n      commit('SET_TOKEN', '')\n      removeToken()\n      resolve()\n    })\n  }\n}\n\nexport default {\n  namespaced: true,\n  state,\n  mutations,\n  actions\n}\n"]}]}