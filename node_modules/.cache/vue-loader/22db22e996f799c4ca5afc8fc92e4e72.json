{"remainingRequest":"F:\\webstormProjects\\vue-hj-platform\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!F:\\webstormProjects\\vue-hj-platform\\src\\views\\stock\\stockList.vue?vue&type=style&index=0&id=11238471&scoped=true&lang=scss&","dependencies":[{"path":"F:\\webstormProjects\\vue-hj-platform\\src\\views\\stock\\stockList.vue","mtime":1652691598000},{"path":"F:\\webstormProjects\\vue-hj-platform\\node_modules\\css-loader\\index.js","mtime":499162500000},{"path":"F:\\webstormProjects\\vue-hj-platform\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":499162500000},{"path":"F:\\webstormProjects\\vue-hj-platform\\node_modules\\sass-loader\\dist\\cjs.js","mtime":499162500000},{"path":"F:\\webstormProjects\\vue-hj-platform\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"F:\\webstormProjects\\vue-hj-platform\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n  .clearfix {\n  line-height: 40px;\n  display: flex;\n}\n/deep/ .el-table__header-wrapper .el-checkbox {\n  display: none;\n}\n/deep/ .el-table__fixed-header-wrapper .el-checkbox {\n  display: none;\n}\n.table-item /deep/ .el-table__header-wrapper .el-checkbox {//table-item 父级类名\n  display: none;\n}\n",{"version":3,"sources":["stockList.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA0cA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"stockList.vue","sourceRoot":"src/views/stock","sourcesContent":["<template>\n  <div class=\"app-container\">\n    <el-form :model=\"searchForm\" :inline=\"true\">\n      <el-row>\n        <el-col :span=\"20\">\n          <el-form-item>\n            <el-input v-model=\"searchForm.sampleNo\" style=\"width:145px\" placeholder=\"请录入样品编号\" />\n          </el-form-item>\n          <el-form-item>\n            <el-select v-model=\"searchForm.sampStatus\" style=\"width:145px\" placeholder=\"请选择库存状态\">\n              <el-option label=\"已入库\" :value=\"6\" />\n              <el-option label=\"部分出库\" :value=\"7\" />\n              <el-option label=\"已出库\" :value=\"8\" />\n            </el-select>\n          </el-form-item>\n          <el-form-item prop=\"signDate\">\n            <el-date-picker\n              v-model=\"searchForm.date\"\n              type=\"date\"\n              value-format=\"yyyy-MM-dd\"\n              placeholder=\"请选择入库日期\"\n              style=\"width: 145px;\"\n            />\n          </el-form-item>\n          <el-form-item>\n            <el-button type=\"primary\" class=\"iconfont icon-chaxun1\" size=\"small\" @click=\"handleSearch\"> 查询</el-button>\n            <el-button type=\"primary\" class=\"iconfont icon-fanhui\" size=\"small\" @click=\"goBack\"> 返回</el-button>\n            <!-- <el-button type=\"primary\" icon=\"el-icon-download\" @click=\"handleDownlond\"> 交接单导出</el-button> -->\n          </el-form-item>\n        </el-col>\n        <el-col :span=\"4\" class=\"search-right\">\n          <el-button type=\"text\" icon=\"el-icon-download\" @click=\"handleDownlond\">交接单下载</el-button>\n          <el-button type=\"text\" icon=\"el-icon-refresh\" @click=\"handleSearch\">刷新</el-button>\n        </el-col>\n      </el-row>\n    </el-form>\n    <div>\n      <el-table\n        ref=\"stockTable\"\n        stripe\n        border\n        :data=\"stockData\"\n        class=\"table-item\"\n        highlight-current-row\n        :header-cell-style=\"{background:'#ECF3FC'}\"\n        style=\"width: 100%\"\n        @selection-change=\"handleSelectionChange\"\n        @select=\"handleSelect\"\n      >\n        <template slot=\"empty\">\n          <div class=\"table_empty\">\n            <div class=\"empty_tips\">\n              <span>\n                暂无审核信息\n              </span>\n            </div>\n          </div>\n        </template>\n        <el-table-column type=\"selection\" width=\"55\" :selectable=\"checkSelectable\" align=\"center\" />\n        <el-table-column prop=\"sampleNo\" label=\"样品编号\" fixed=\"left\" width=\"150px\" align=\"center\" />\n        <el-table-column prop=\"jobId\" label=\"任务单号\" width=\"130px\" align=\"center\" />\n        <el-table-column prop=\"projectName\" label=\"项目名称\" min-width=\"150px\" align=\"center\" />\n        <el-table-column prop=\"secdClassName\" label=\"检测类别\" align=\"center\" />\n        <el-table-column prop=\"factorPoint\" label=\"采样点位\" min-width=\"100px\" align=\"center\" />\n        <el-table-column prop=\"collectUser\" label=\"采样人\" align=\"center\" />\n        <el-table-column prop=\"reviewUser\" label=\"复核人\" width=\"100px\" align=\"center\" />\n        <el-table-column prop=\"storeLocation\" label=\"存放位置\" min-width=\"100px\" align=\"center\" />\n        <el-table-column prop=\"inspectionName\" label=\"受检单位\" min-width=\"120px\" align=\"center\" />\n\n        <el-table-column label=\"库存状态\" align=\"center\">\n          <template slot-scope=\"{row}\">\n            <el-tag :type=\"row.sampStatus|statusQualityFilter\">\n              {{ STOCK_STATUS[row.sampStatus] }}\n            </el-tag>\n          </template>\n        </el-table-column>\n\n        <el-table-column prop=\"storeTime\" label=\"入库时间\" width=\"160\" align=\"center\" />\n        <el-table-column fixed=\"right\" align=\"center\" label=\"操作\" width=\"150\">\n          <template slot-scope=\"scope\">\n            <el-button type=\"text\" @click=\"handleDetail(scope.row)\"> 查看</el-button>\n          </template>\n        </el-table-column>\n      </el-table>\n    </div>\n    <div style=\"float: right\">\n      <pagination\n        v-show=\"total>0\"\n        :total=\"total\"\n        :page.sync=\"searchForm.pageNumber\"\n        :limit.sync=\"searchForm.pageSize\"\n        @pagination=\"handleSearch\"\n      />\n    </div>\n\n    <el-dialog :title=\"currentSample + '-详情'\" :visible.sync=\"sampleVisible\" width=\"85%\" center top=\"5vh\">\n      <el-form :model=\"sampleDetailForm\" label-width=\"180px\" label-position=\"right\">\n        <el-card style=\"margin-top: 5px;padding-bottom: 20px;\">\n          <div slot=\"header\" class=\"clearfix\">\n            <div style=\"width: 3px;margin:auto 3px; height: 20px;background-color:steelblue;\" />\n            <span>基础信息</span>\n          </div>\n          <el-col :span=\"16\" style=\"height:32px;\">\n            <el-form-item label-width=\"100\" label=\"检测因子:\">\n              <span class=\"showTile\">{{ sampleDetailForm.factorName }}</span>\n            </el-form-item>\n          </el-col>\n          <el-col :span=\"8\" style=\"height:32px;\">\n            <el-form-item label-width=\"100\" label=\"点位:\">\n              <span class=\"showTile\">{{ sampleDetailForm.factorPoint }}</span>\n            </el-form-item>\n          </el-col>\n          <!--动态二级类别信息-->\n        </el-card>\n        <el-card v-for=\"item in sampleSecInfo\" :key=\"item.groupKey\" style=\"margin-top: 5px;padding-bottom: 20px;\">\n          <div v-if=\"item.groupName && item.groupName != ''\" slot=\"header\" class=\"clearfix\">\n            <div style=\"width: 3px;margin:auto 3px; height: 20px;background-color:steelblue;\" />\n            <span>{{ item.groupName }}</span>\n          </div>\n          <el-col v-for=\"(sitem,index) in item.params\" :key=\"index\" :span=\"8\" style=\"height:32px;\">\n            <el-form-item label-width=\"100\">\n              <span slot=\"label\">{{ sitem.name }}:</span>\n              <span class=\"showTile\">{{ sitem.value?sitem.value.toString():'' }}</span>\n            </el-form-item>\n          </el-col>\n        </el-card>\n\n        <el-card v-if=\"sampleDataInfo && sampleDataInfo.length > 0\" style=\"margin-top: 5px\">\n          <div slot=\"header\" class=\"clearfix\">\n            <div style=\"width: 3px;margin:auto 3px; height: 20px;background-color:steelblue;\" />\n            <span>现场检测因子信息</span>\n          </div>\n          <el-table :data=\"sampleDataInfo\" stripe>\n            <el-table-column prop=\"factorName\" label=\"检测因子项目\" />\n            <el-table-column label=\"因子结果集\">\n              <template slot-scope=\"{row}\">\n                <template v-if=\"row.measuredForm\">\n                  {{ '第一值: ' +row.measuredForm.firstVal + ' 第二值: ' + row.measuredForm.secondVal + \" 均值: \" + row.measuredForm.avgVal }}\n                </template>\n                <template v-else>\n                  {{ row.factorData?row.factorData:'' }}\n                </template>\n              </template>\n            </el-table-column>\n            <el-table-column prop=\"checkEquipment\" label=\"检测设备\">\n              <template slot-scope=\"{row}\">\n                {{ row.checkEquipment&&row.checkEquipment.length>0?row.checkEquipment.replaceAll('^_^',' '):'' }}\n              </template>\n            </el-table-column>\n            <el-table-column prop=\"theoreticalVal\" label=\"理论值\" />\n            <el-table-column prop=\"groundConditions\" label=\"测定值\" />\n          </el-table>\n        </el-card>\n\n        <el-card style=\"margin-top: 5px\">\n          <div slot=\"header\" class=\"clearfix\">\n            <div style=\"width: 3px;margin:auto 3px; height: 20px;background-color:steelblue;\" />\n            <span>现场信息</span>\n          </div>\n          <el-col :span=\"12\">\n            <el-form-item label-width=\"100\" label=\"采样地址:\">\n              <span class=\"showTile\">{{ sampleDetailForm.sampleDataVo.collectLocation }}</span>\n            </el-form-item>\n          </el-col>\n          <el-col :span=\"12\">\n            <el-form-item label-width=\"100\" label=\"采样日期:\">\n              <span class=\"showTile\">{{ sampleDetailForm.sampleDataVo.collectDate }}</span>\n            </el-form-item>\n          </el-col>\n          <el-col :span=\"24\">\n            <el-form-item label-width=\"100\" label=\"现场图片:\">\n              <div v-if=\"sampleImageList && sampleImageList.length > 0\" class=\"demo-image__lazy\">\n                <el-image v-for=\"(url, index) in sampleImageList\" :key=\"index\" :src=\"url\" :preview-src-list=\"sampleImageList\" style=\"width: 100px; height: 100px;margin-left: 10px;\" />\n              </div>\n            </el-form-item>\n          </el-col>\n        </el-card>\n      </el-form>\n      <div slot=\"footer\" class=\"dialog-footer\">\n        <el-button @click=\"sampleVisible=false\">关 闭</el-button>\n      </div>\n    </el-dialog>\n\n    <el-dialog title=\"交接单下载\" :visible.sync=\"downVisible\" center>\n      <div style=\"width: 500px;margin:0 auto\">\n        <el-form :model=\"recordForm\" label-width=\"130px\">\n          <el-form-item label=\"任务单号:\">\n            <el-input v-model=\"recordForm.taskId\" placeholder=\"请录入任务单号\" style=\"width:300px\" />\n          </el-form-item>\n          <el-form-item label=\"检测对象:\">\n            <el-select v-model=\"recordForm.classId\" clearable style=\"width:300px\" filterable placeholder=\"检测对象\" @change=\"findSecClass\">\n              <el-option\n                v-for=\"item in classArray\"\n                :key=\"item.id\"\n                :label=\"item.name\"\n                :value=\"item.id\"\n              />\n            </el-select>\n          </el-form-item>\n          <el-form-item label=\"检测类别:\">\n            <el-select v-model=\"recordForm.secClassId\" clearable style=\"width:300px\" filterable placeholder=\"检测类别\">\n              <el-option\n                v-for=\"item in secClassArray\"\n                :key=\"item.id\"\n                :label=\"item.name\"\n                :value=\"item.id\"\n              />\n            </el-select>\n          </el-form-item>\n          <el-form-item label=\"采样信息记录时间:\">\n            <el-date-picker\n              v-model=\"recordForm.sampleDate\"\n              type=\"date\"\n              placeholder=\"采样信息记录时间\"\n              value-format=\"yyyy-MM-dd\"\n              style=\"width:300px\"\n            />\n          </el-form-item>\n        </el-form>\n      </div>\n      <div slot=\"footer\" class=\"dialog-footer\">\n        <el-button @click=\"downVisible=false\">取消</el-button>\n        <el-button type=\"primary\" @click=\"confirmDownload\">确认</el-button>\n      </div>\n    </el-dialog>\n  </div>\n</template>\n\n<script>\nimport * as stockServer from '@/api/stock'\nimport * as dictServer from '@/api/dict'\nimport { parseTime } from '@/utils'\nimport Pagination from '@/components/Pagination' // Secondary package based on el-pagination\nconst STOCK_STATUS = {\n  '0': '待采样',\n  '1': '已采样',\n  '2': '待组长审核',\n  '3': '待负责人审核',\n  '4': '审核通过',\n  '5': '审核失败',\n  '6': '已入库',\n  '7': '部分出库',\n  '8': '已出库',\n  '9': '入库中',\n  '10': '待复核'\n}\nexport default {\n  components: { Pagination },\n  filters: {\n    statusQualityFilter(status) {\n      const statusMap = {\n        '6': '',\n        '7': 'success',\n        '8': 'success'\n      }\n      return statusMap[status]\n    }\n  },\n  data() {\n    return {\n      STOCK_STATUS,\n      stockData: [],\n      searchForm: {\n        sampTaskId: '',\n        sampleNo: '',\n        sampStatus: '',\n        date: '',\n        pageNumber: 1,\n        pageSize: 10\n      },\n      total: 0,\n      approveVisible: false,\n      sampleVisible: false,\n      sampleDetailForm: {\n        factorName: '',\n        factorPoint: '',\n        secdClassName: '',\n        factorDataVos: [],\n        sampleDataVo: {\n          collectDate: '',\n          collectLocation: '',\n          imageList: [],\n          sampleData: [],\n          specialNote: ''\n        },\n        sampleJobVo: {\n          projectName: '',\n          jobRemark: ''\n        }\n      },\n      currentSample: '',\n      approveForm: {\n        sampleNo: '',\n        auditFlag: '1',\n        auditReason: ''\n      },\n      sampleImage: '',\n      sampleImageList: [],\n      multipleSelection: [],\n      downVisible: false,\n      recordForm: {\n        taskId: '',\n        classId: '',\n        secClassId: '',\n        sampleDate: ''\n      },\n      classArray: [],\n      secClassArray: [],\n      sampleDetails: [],\n      sampleDataInfo: [],\n      sampleSecInfo: [],\n      currentSelectionRow: {\n        jobId: '',\n        secdClassName: '',\n        storeData: ''\n      }\n    }\n  },\n  created() {\n    if (this.$route.params.sampTaskId) {\n      this.searchForm.sampTaskId = this.$route.params.sampTaskId\n      this.getClassList()\n      this.handleSearch()\n    }\n  },\n  methods: {\n    handleSearch() {\n      if (this.searchForm.jobId !== '') {\n        this.clearSelectionRow()\n        stockServer.getSamplesBySampTaskId(this.searchForm).then(res => {\n          if (res.code === 200 && res.result) {\n            this.stockData = res.result.records.map(i => {\n              const sData = parseTime(i.storeTime, '{y}-{m}-{d}')\n              this.$set(i, 'storeData', sData)\n              return i\n            }) || []\n            this.total = res.result.total\n          }\n        })\n      }\n    },\n    handleDetail(row) {\n      // 获取数据\n      this.currentSample = row.sampleNo\n      this.sampleImageList = []\n      this.sampleDataInfo = []\n      this.sampleSecInfo = []\n      this.sampleImage = ''\n      var baseUrl = this.$store.getters.sysBaseUrl + '/cyImg/'\n      stockServer.getSampleDataBySampItemId(row.sampItemId).then(res => {\n        if (res.code === 200 && res.result) {\n          this.sampleDetailForm = res.result || {}\n          this.$nextTick(() => {\n            // 提取图片\n            this.sampleImageList = res.result.sampleDataVo.imageList.map(i => {\n              return baseUrl + i\n            })\n            // 二级类别\n            this.sampleSecInfo = res.result.sampleDataVo.sampleData || []\n\n            // 因子\n            var nfactorDataVos = res.result.factorDataVos.filter(i => i.dataEntryStep === '1') || []\n            // 因子\n            this.sampleDataInfo = nfactorDataVos.map(i => {\n              if (i.measuredFormVal && i.measuredFormVal.length > 0) {\n                this.$set(i, 'measuredForm', JSON.parse(i.measuredFormVal))\n              }\n              return i\n            })\n          })\n          this.sampleVisible = true\n        }\n      })\n\n      // stockServer.getSampleDetailBySampItemId(row.sampleNo).then(res => {\n      //   if (res.code === 200) {\n      //     this.sampleForm = res.result || {}\n      //   }\n      //   this.sampleVisible = true\n      // })\n      // 封装展示数据\n    },\n    handleSelectionChange(val) {\n      this.multipleSelection = val\n    },\n    handleDownlond() {\n      // this.recordForm.taskId = ''\n      // this.recordForm.classId = ''\n      // this.recordForm.secClassId = ''\n      // this.downVisible = true\n      if (this.multipleSelection && this.multipleSelection.length > 0) {\n        const samples = this.multipleSelection.map(i => {\n          return i.sampleNo\n        })\n        const url = '/api/word/downLoadHandover?secdClassId=' + this.multipleSelection[0].secdClassId + '&sampleNos=' + samples.toString()\n        window.open(url)\n      } else {\n        this.$message.warning('至少选择一条记录')\n      }\n    },\n    getClassList() {\n      dictServer.findFstClasses().then(res => {\n        this.classArray = res.result || []\n      })\n    },\n    findSecClass(val) {\n      this.recordForm.secClassId = ''\n      dictServer.findSecdClassByClassId(val).then(res => {\n        this.secClassArray = res.result || []\n      })\n    },\n    confirmDownload() {\n      if (this.recordForm.taskId && this.recordForm.secClassId && this.recordForm.sampleDate) {\n        const url = '/api/word/downLoadHandover?taskId=' + this.recordForm.taskId + '&secdClassId=' + this.recordForm.secClassId + '&sampleDate=' + this.recordForm.sampleDate\n        window.open(url)\n        this.downVisible = false\n      } else {\n        this.$message.warning('任务单号和检测类别不能为空')\n      }\n    },\n    handleSelect(selection, row) {\n      if (selection.length > 0) {\n        this.currentSelectionRow.jobId = row.jobId\n        this.currentSelectionRow.secdClassName = row.secdClassName\n        this.currentSelectionRow.storeData = row.storeData\n      } else {\n        this.clearSelectionRow()\n      }\n    },\n    clearSelectionRow() {\n      this.currentSelectionRow = {\n        jobId: '',\n        secdClassName: '',\n        storeData: ''\n      }\n    },\n    checkRow(item) {\n      if (!this.currentSelectionRow.jobId || this.currentSelectionRow.jobId === '') {\n        return true\n      }\n      if (item.jobId === this.currentSelectionRow.jobId &&\n        item.secdClassName === this.currentSelectionRow.secdClassName &&\n        item.storeData === this.currentSelectionRow.storeData) {\n        return true\n      }\n      return false\n    },\n    checkSelectable(row) {\n      return this.checkRow(row)\n    },\n    goBack() {\n      this.$router.back()\n    }\n  }\n}\n</script>\n\n<style scoped lang=\"scss\" >\n    .clearfix {\n    line-height: 40px;\n    display: flex;\n  }\n  /deep/ .el-table__header-wrapper .el-checkbox {\n    display: none;\n  }\n  /deep/ .el-table__fixed-header-wrapper .el-checkbox {\n    display: none;\n  }\n  .table-item /deep/ .el-table__header-wrapper .el-checkbox {//table-item 父级类名\n    display: none;\n  }\n</style>\n"]}]}