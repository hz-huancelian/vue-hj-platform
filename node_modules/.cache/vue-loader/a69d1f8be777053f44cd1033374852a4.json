{"remainingRequest":"F:\\webstormProjectsJiu\\vue-hj-platform\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!F:\\webstormProjectsJiu\\vue-hj-platform\\src\\views\\system\\user\\index.vue?vue&type=style&index=0&id=1930a3c4&scoped=true&lang=scss&","dependencies":[{"path":"F:\\webstormProjectsJiu\\vue-hj-platform\\src\\views\\system\\user\\index.vue","mtime":1651301394000},{"path":"F:\\webstormProjectsJiu\\vue-hj-platform\\node_modules\\css-loader\\index.js","mtime":499162500000},{"path":"F:\\webstormProjectsJiu\\vue-hj-platform\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":499162500000},{"path":"F:\\webstormProjectsJiu\\vue-hj-platform\\node_modules\\sass-loader\\dist\\cjs.js","mtime":499162500000},{"path":"F:\\webstormProjectsJiu\\vue-hj-platform\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"F:\\webstormProjectsJiu\\vue-hj-platform\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n.time-dot {\n  text-align: center;\n  justify-content: center;\n  padding-top: 4px;\n  position: relative;\n  border-radius: 50%;\n  background: #dfe4ed;\n  height: 25px;\n  width: 25px;\n  left: -7px;\n}\n",{"version":3,"sources":["index.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAwzBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"index.vue","sourceRoot":"src/views/system/user","sourcesContent":["<template>\n  <div class=\"app-container\">\n    <el-row :gutter=\"20\">\n      <!--部门数据-->\n      <el-col :span=\"4\" :xs=\"24\">\n        <div class=\"head-container\">\n          <el-input\n            v-model=\"deptName\"\n            placeholder=\"请输入部门名称\"\n            clearable\n            size=\"small\"\n            prefix-icon=\"el-icon-search\"\n            style=\"margin-bottom: 20px;\"\n          />\n        </div>\n        <div class=\"head-container\">\n          <el-tree\n            ref=\"tree\"\n            :data=\"deptOptions\"\n            :props=\"defaultProps\"\n            :expand-on-click-node=\"false\"\n            :filter-node-method=\"filterNode\"\n            default-expand-all\n            @node-click=\"handleNodeClick\"\n          />\n        </div>\n      </el-col>\n      <!--用户数据-->\n      <el-col :span=\"20\" :xs=\"24\">\n        <el-row>\n          <el-col :span=\"18\">\n\n            <el-form v-show=\"showSearch\" ref=\"queryForm\" :model=\"queryParams\" :inline=\"true\">\n              <el-form-item label=\"员工姓名\" prop=\"empName\">\n                <el-input\n                  v-model=\"queryParams.empName\"\n                  placeholder=\"请输入\"\n                  clearable\n                  style=\"width: 120px\"\n                  @keyup.enter.native=\"handleQuery\"\n                />\n              </el-form-item>\n              <el-form-item label=\"手机号码\" prop=\"phonenumber\">\n                <el-input\n                  v-model=\"queryParams.phonenumber\"\n                  placeholder=\"请输入\"\n                  clearable\n                  style=\"width: 120px\"\n                  @keyup.enter.native=\"handleQuery\"\n                />\n              </el-form-item>\n              <el-form-item label=\"状态\" prop=\"status\">\n                <el-select\n                  v-model=\"queryParams.status\"\n                  placeholder=\"状态\"\n                  clearable\n                  style=\"width: 100px\"\n                >\n                  <el-option\n                    v-for=\"dict in statusOptions\"\n                    :key=\"dict.dictValue\"\n                    :label=\"dict.dictLabel\"\n                    :value=\"dict.dictValue\"\n                  />\n                </el-select>\n              </el-form-item>\n              <el-form-item>\n                <el-button type=\"primary\" icon=\"el-icon-search\" size=\"small\" @click=\"handleQuery\">搜索</el-button>\n                <el-button icon=\"el-icon-refresh\" size=\"small\" @click=\"resetQuery\">重置</el-button>\n              </el-form-item>\n            </el-form>\n          </el-col>\n          <el-col :span=\"6\">\n            <el-button type=\"text\" size=\"small\" icon=\"el-icon-plus\" @click=\"handleAdd\">新增</el-button>\n            <el-button type=\"text\" size=\"small\" icon=\"el-icon-upload2\" @click=\"handleUpload\">批量导入</el-button>\n            <el-button type=\"text\" size=\"small\" icon=\"el-icon-download\" @click=\"handleDownload\">导出</el-button>\n            <el-button type=\"text\" size=\"small\" icon=\"el-icon-refresh\" @click=\"handleQuery\">刷新</el-button>\n          </el-col>\n        </el-row>\n\n        <!-- <el-row :gutter=\"10\" class=\"mb8\">\n          <el-col :span=\"1.5\">\n            <el-button\n              type=\"primary\"\n              plain\n              icon=\"el-icon-plus\"\n              size=\"small\"\n              @click=\"handleAdd\"\n            >新增</el-button>\n            <el-button\n              type=\"primary\"\n              plain\n              icon=\"el-icon-download\"\n              size=\"small\"\n              @click=\"handleDownload\"\n            >导出</el-button>\n          </el-col>\n          <right-toolbar :show-search.sync=\"showSearch\" :columns=\"columns\" @queryTable=\"getList\" />\n        </el-row> -->\n\n        <el-table v-loading=\"loading\" :data=\"userList\" @selection-change=\"handleSelectionChange\">\n          <el-table-column type=\"index\" label=\"序号\" width=\"50\" align=\"center\" />\n          <el-table-column label=\"员工工号\" align=\"center\" prop=\"empCode\" :show-overflow-tooltip=\"true\" />\n          <el-table-column label=\"员工姓名\" align=\"center\" prop=\"empName\" :show-overflow-tooltip=\"true\" />\n          <el-table-column label=\"登录账号\" align=\"center\" width=\"100px\" prop=\"username\" :show-overflow-tooltip=\"true\" />\n          <el-table-column label=\"部门\" align=\"center\" prop=\"deptName\" :show-overflow-tooltip=\"true\" />\n          <el-table-column label=\"岗位\" align=\"center\" prop=\"postNames\" :show-overflow-tooltip=\"true\" />\n          <el-table-column label=\"角色\" align=\"center\" prop=\"roleNames\" :show-overflow-tooltip=\"true\" />\n          <el-table-column label=\"手机号码\" align=\"center\" prop=\"phonenumber\" width=\"120\" />\n          <el-table-column label=\"状态\" align=\"center\">\n            <template slot-scope=\"scope\">\n              <el-tag :type=\"scope.row.status==='0'?'success':'danger'\">{{ scope.row.status==='0'?'正常':'停用' }}</el-tag>\n            </template>\n          </el-table-column>\n          <el-table-column v-if=\"columns[6].visible\" label=\"创建日期\" align=\"center\" prop=\"createTime\" width=\"120\">\n            <template slot-scope=\"scope\">\n              <span>{{ parseTime(scope.row.createTime, '{y}-{m}-{d}') }}</span>\n            </template>\n          </el-table-column>\n          <el-table-column\n            label=\"操作\"\n            align=\"center\"\n            width=\"160\"\n            class-name=\"small-padding fixed-width\"\n          >\n            <template v-if=\"scope.row.deptId !== '-1'\" slot-scope=\"scope\">\n              <el-button\n                size=\"mini\"\n                type=\"text\"\n                icon=\"el-icon-edit\"\n                @click=\"handleUpdate(scope.row)\"\n              >修改</el-button>\n              <!-- <el-button\n                size=\"mini\"\n                type=\"text\"\n                icon=\"el-icon-key\"\n                @click=\"handleResetPwd(scope.row)\"\n              >重置密码</el-button> -->\n              <el-button\n                v-if=\"scope.row.status==='0'\"\n                size=\"mini\"\n                type=\"text\"\n                icon=\"el-icon-delete\"\n                @click=\"handleDelete(scope.row)\"\n              >注销</el-button>\n              <el-button\n                v-if=\"scope.row.status==='1'\"\n                size=\"mini\"\n                type=\"text\"\n                icon=\"el-icon-success\"\n                @click=\"handleOnline(scope.row)\"\n              >启用</el-button>\n              <el-dropdown size=\"mini\" @command=\"(command) => handleCommand(command, scope.row)\">\n                <span class=\"el-dropdown-link\" style=\"font-size:12px;\">\n                  <i class=\"el-icon-d-arrow-right el-icon--right\" />更多\n                </span>\n                <el-dropdown-menu slot=\"dropdown\">\n                  <el-dropdown-item\n                    command=\"handleResetPwd\"\n                    icon=\"el-icon-key\"\n                  >重置密码</el-dropdown-item>\n                  <!-- <el-dropdown-item\n                    command=\"handleAuthRole\"\n                    icon=\"el-icon-circle-check\"\n                  >分配角色</el-dropdown-item> -->\n                </el-dropdown-menu>\n              </el-dropdown>\n            </template>\n          </el-table-column>\n        </el-table>\n\n        <pagination\n          v-show=\"total>0\"\n          :total=\"total\"\n          :page.sync=\"queryParams.pageNumber\"\n          :limit.sync=\"queryParams.pageSize\"\n          @pagination=\"getList\"\n        />\n      </el-col>\n    </el-row>\n\n    <!-- 添加或修改参数配置对话框 -->\n    <el-dialog :title=\"title\" :visible.sync=\"open\" width=\"720px\" append-to-body :close-on-click-modal=\"false\">\n      <el-form ref=\"form\" :model=\"form\" :rules=\"rules\" label-width=\"100px\">\n        <el-row :gutter=\"10\">\n          <el-col :span=\"12\">\n            <el-form-item label=\"员工工号\" prop=\"empCode\">\n              <el-input v-model=\"form.empCode\" placeholder=\"请输入员工工号\" maxlength=\"30\" />\n            </el-form-item>\n          </el-col>\n        </el-row>\n        <el-row :gutter=\"10\">\n          <el-col :span=\"12\">\n            <el-form-item label=\"员工姓名\" prop=\"empName\">\n              <el-input v-model=\"form.empName\" placeholder=\"请输入姓名\" maxlength=\"30\" />\n            </el-form-item>\n          </el-col>\n          <el-col :span=\"12\">\n            <el-form-item label=\"归属部门\" prop=\"deptId\">\n              <treeselect v-model=\"form.deptId\" :options=\"deptOptions\" :show-count=\"true\" placeholder=\"请选择归属部门\" />\n            </el-form-item>\n          </el-col>\n        </el-row>\n        <el-row :gutter=\"10\">\n          <el-col :span=\"12\">\n            <el-form-item label=\"手机号码\" prop=\"phonenumber\">\n              <el-input v-model=\"form.phonenumber\" placeholder=\"请输入手机号码\" maxlength=\"11\" />\n            </el-form-item>\n          </el-col>\n          <el-col :span=\"12\">\n            <el-form-item label=\"个人邮箱\" prop=\"email\">\n              <el-input v-model=\"form.email\" placeholder=\"请输入邮箱\" maxlength=\"50\" />\n            </el-form-item>\n          </el-col>\n        </el-row>\n        <el-row :gutter=\"10\">\n          <el-col :span=\"12\">\n            <el-form-item label=\"性别\">\n              <el-select v-model=\"form.sex\" placeholder=\"请选择\">\n                <el-option\n                  v-for=\"dict in sexOptions\"\n                  :key=\"dict.dictValue\"\n                  :label=\"dict.dictLabel\"\n                  :value=\"dict.dictValue\"\n                />\n              </el-select>\n            </el-form-item>\n          </el-col>\n          <!-- <el-col :span=\"12\">\n            <el-form-item label=\"状态\">\n              <el-radio-group v-model=\"form.status\">\n                <el-radio\n                  v-for=\"dict in statusOptions\"\n                  :key=\"dict.dictValue\"\n                  :label=\"dict.dictValue\"\n                >{{ dict.dictLabel }}</el-radio>\n              </el-radio-group>\n            </el-form-item>\n          </el-col> -->\n        </el-row>\n\n        <el-row :gutter=\"10\">\n          <el-col :span=\"12\">\n            <el-form-item>\n              <span slot=\"label\">\n                岗位\n                <el-popover\n                  placement=\"top-start\"\n                  title=\"\"\n                  width=\"400\"\n                  trigger=\"hover\"\n                  content=\"岗位是员工在公司里的内部职称，一个员工对应一个岗位，岗位名称可以任意命名，员工岗位与权限没有任何关联。\"\n                >\n                  <svg-icon slot=\"reference\" icon-class=\"help\" style=\"font-size:16px\" />\n                </el-popover>\n              </span>\n              <el-select v-model=\"postId\" placeholder=\"请选择\" @change=\"getPostInfo\">\n                <el-option\n                  v-for=\"item in postOptions\"\n                  :key=\"item.postId\"\n                  :label=\"item.postName\"\n                  :value=\"item.postId\"\n                  :disabled=\"item.status == 1\"\n                />\n              </el-select>\n            </el-form-item>\n          </el-col>\n          <el-col :span=\"12\">\n            <el-form-item>\n              <span slot=\"label\">\n                角色\n                <el-popover\n                  placement=\"top-start\"\n                  title=\"\"\n                  width=\"300\"\n                  trigger=\"hover\"\n                  content=\"角色是平台内设定的统一固定称谓，一个员工可以对应多个角色，\n                  也就是说可以同时拥有多个角色的权限，以解决某些员工身兼数职的问题。\n                  角色名称是系统默认固定的，但是角色的数据权限和菜单权限管理员可以进行更改，\n                  请根据需要谨慎更改。平台后期可能新增角色，但不会对现有角色进行修改，\n                  若点击恢复默认权限，则会恢复到平台给予当前角色的默认权限。\"\n                >\n                  <svg-icon slot=\"reference\" icon-class=\"help\" style=\"font-size:16px\" />\n                </el-popover>\n              </span>\n              <el-select v-model=\"form.roleIds\" multiple placeholder=\"请选择\">\n                <el-option\n                  v-for=\"item in roleOptions\"\n                  :key=\"item.roleId\"\n                  :label=\"item.roleName\"\n                  :value=\"item.roleId\"\n                  :disabled=\"item.status == 1\"\n                />\n              </el-select>\n            </el-form-item>\n          </el-col>\n        </el-row>\n        <el-row :gutter=\"10\">\n          <el-col :span=\"12\">\n            <el-form-item prop=\"isAppLogin\">\n              <span slot=\"label\">\n                小程序\n                <el-popover\n                  placement=\"top-start\"\n                  title=\"\"\n                  width=\"300\"\n                  trigger=\"hover\"\n                  content=\"允许采样组长/采样员通过手机端进行现场采样录样操作，如果员工的角色含有采样组长或采样员，建议打开允许按钮\"\n                >\n                  <svg-icon slot=\"reference\" icon-class=\"help\" style=\"font-size:16px\" />\n                </el-popover>\n              </span>\n              <el-switch\n                v-model=\"form.isAppLogin\"\n                active-text=\"允许\"\n                inactive-text=\"不允许\"\n                active-value=\"1\"\n                inactive-value=\"0\"\n                @change=\"switchChange\"\n              />\n            </el-form-item>\n          </el-col>\n          <el-col :span=\"12\">\n            <el-form-item v-if=\"form.isAppLogin==1\" label=\"小程序角色\" prop=\"appRoles\">\n              <el-select v-model=\"form.appRoles\" multiple clearable>\n                <el-option\n                  v-for=\"item in dataAppOptions\"\n                  :key=\"item.value\"\n                  :label=\"item.label\"\n                  :value=\"item.value\"\n                />\n              </el-select>\n            </el-form-item>\n          </el-col>\n        </el-row>\n        <el-row :gutter=\"10\">\n          <el-col :span=\"24\">\n            <el-form-item label=\"备注\">\n              <el-input v-model=\"form.remark\" type=\"textarea\" placeholder=\"请输入内容\" />\n            </el-form-item>\n          </el-col>\n        </el-row>\n      </el-form>\n      <div slot=\"footer\" class=\"dialog-footer\">\n        <el-button type=\"primary\" @click=\"submitForm\">确 定</el-button>\n        <el-button @click=\"cancel\">取 消</el-button>\n      </div>\n    </el-dialog>\n\n    <el-dialog title=\"批量导入员工\" :visible.sync=\"uploadVisible\" append-to-body>\n      <div class=\"block\">\n        <el-timeline>\n          <el-timeline-item size=\"large\">\n            <span slot=\"dot\" class=\"time-dot\">\n              1\n            </span>\n            <el-row>\n              <el-col :span=\"24\">\n                下载模板，批量填写员工信息\n              </el-col>\n            </el-row>\n            <el-row style=\"padding-top:10px;\">\n              <el-col :span=\"24\">\n                <el-button size=\"mini\" type=\"primary\" @click=\"downloadTem()\">模板下载</el-button>\n              </el-col>\n            </el-row>\n          </el-timeline-item>\n          <el-timeline-item size=\"large\">\n            <span slot=\"dot\" class=\"time-dot\">\n              2\n            </span>\n            <el-row>\n              <el-col :span=\"24\">\n                上传填写好的员工信息表格\n              </el-col>\n            </el-row>\n            <el-row style=\"padding-top:10px;\">\n              <el-col :span=\"24\">\n                <el-upload\n                  class=\"upload-demo\"\n                  action=\"/api/dataImport/uploadEmployee\"\n                  :on-change=\"uploadChange\"\n                  :file-list=\"excelFileList\"\n                  accept=\".xlsx,.xls\"\n                  :limit=\"1\"\n                  style=\"width: 300px;\"\n                >\n                  <el-button size=\"mini\" type=\"primary\">点击上传</el-button>\n                  <!-- <div class=\"el-upload__text\"><em>点击上传</em></div> -->\n                  <div slot=\"tip\" class=\"el-upload__tip\" style=\"color:red;\">您只能上传.xlsx,.xls格式的文件</div>\n                </el-upload>\n              </el-col>\n            </el-row>\n          </el-timeline-item>\n        </el-timeline>\n        <el-row>\n          <el-col :span=\"24\" style=\"\">\n            <span style=\"color:red; font-size: 13px\">备注：批量导入员工功能，只会将上传的员工信息列表内的员工新增到系统内，不对原有员工信息做任何替换或修改</span>\n          </el-col>\n        </el-row>\n      </div>\n    </el-dialog>\n  </div>\n</template>\n\n<script>\nimport { listUser, getUser, addUser, updateUser, resetOriganPassword, changeUserStatus, invalidUserByUserId, onlineUserByUserId } from '@/api/system/user'\nimport * as deptServer from '@/api/dept'\nimport { selectPostAll } from '@/api/system/post'\nimport { getAllRole } from '@/api/system/role'\nimport Treeselect from '@riophae/vue-treeselect'\nimport '@riophae/vue-treeselect/dist/vue-treeselect.css'\n\nexport default {\n  name: 'User',\n  components: { Treeselect },\n  data() {\n    return {\n      // 遮罩层\n      loading: false,\n      // 导出遮罩层\n      exportLoading: false,\n      // 选中数组\n      ids: [],\n      // 非单个禁用\n      single: true,\n      // 非多个禁用\n      multiple: true,\n      // 显示搜索条件\n      showSearch: true,\n      // 总条数\n      total: 0,\n      // 用户表格数据\n      userList: null,\n      // 弹出层标题\n      title: '',\n      // 部门树选项\n      deptOptions: undefined,\n      // 是否显示弹出层\n      open: false,\n      // 部门名称\n      deptName: undefined,\n      // 默认密码\n      initPassword: undefined,\n      // 日期范围\n      dateRange: [],\n      // 状态数据字典\n      statusOptions: [\n        { dictLabel: '正常', dictValue: '0' },\n        { dictLabel: '停用', dictValue: '1' }\n      ],\n      // 性别状态字典\n      sexOptions: [\n        { dictLabel: '男', dictValue: '0' },\n        { dictLabel: '女', dictValue: '1' }\n      ],\n      // 岗位选项\n      postOptions: [],\n      // 角色选项\n      roleOptions: [],\n      // 表单参数\n      form: {},\n      defaultProps: {\n        children: 'children',\n        label: 'label',\n        id: 'id'\n      },\n      // 查询参数\n      queryParams: {\n        pageNumber: 1,\n        pageSize: 10,\n        empName: '',\n        phonenumber: '',\n        deptId: undefined\n      },\n      dataAppOptions: [\n        {\n          value: '1',\n          label: '采样组长'\n        },\n        {\n          value: '2',\n          label: '采样员'\n        }\n        // {\n        //   value: '3',\n        //   label: '样品管理员'\n        // },\n        // {\n        //   value: '4',\n        //   label: '检测员'\n        // }\n      ],\n      postId: '',\n      // 列信息\n      columns: [\n        { key: 0, label: `用户编号`, visible: true },\n        { key: 1, label: `用户名称`, visible: true },\n        { key: 2, label: `用户账号`, visible: true },\n        { key: 3, label: `部门`, visible: true },\n        { key: 4, label: `手机号码`, visible: true },\n        { key: 5, label: `状态`, visible: true },\n        { key: 6, label: `创建时间`, visible: true }\n      ],\n      // 表单校验\n      rules: {\n        empCode: [\n          { required: true, message: '工号不能为空', trigger: 'blur' }\n        ],\n        empName: [\n          { required: true, message: '真实名称不能为空', trigger: 'blur' }\n        ],\n        email: [\n          {\n            type: 'email',\n            message: \"'请输入正确的邮箱地址\",\n            trigger: ['blur', 'change']\n          }\n        ],\n        phonenumber: [\n          { required: true, message: '手机号码不能为空', trigger: 'blur' },\n          {\n            pattern: /^1[3|4|5|6|7|8|9][0-9]\\d{8}$/,\n            message: '请输入正确的手机号码',\n            trigger: 'blur'\n          }\n        ]\n      },\n\n      excelFileList: [],\n      uploadVisible: false\n    }\n  },\n  watch: {\n    // 根据名称筛选部门树\n    deptName(val) {\n      this.$refs.tree.filter(val)\n    }\n  },\n  created() {\n    this.getList()\n    this.getTreeselect()\n    this.getPostAndRoleList()\n    // this.getDicts('sys_normal_disable').then(response => {\n    //   this.statusOptions = response.data\n    // })\n    // this.getDicts('sys_user_sex').then(response => {\n    //   this.sexOptions = response.data\n    // })\n    // this.getConfigKey('sys.user.initPassword').then(response => {\n    //   this.initPassword = response.msg\n    // })\n  },\n  methods: {\n    /** 查询用户列表 */\n    getList() {\n      this.loading = true\n      listUser(this.queryParams).then(response => {\n        this.userList = response.result.records\n        this.total = response.result.total\n        this.loading = false\n      }).catch(() => {\n        this.loading = false\n      })\n    },\n    /** 查询部门下拉树结构 */\n    getTreeselect() {\n      this.deptOptions = []\n      deptServer.treeselect().then(res => {\n        this.deptOptions = this.doProcessDept(res.result) || []\n      })\n    },\n    doProcessDept(depts) {\n      const res = []\n      depts.forEach(e => {\n        const tmp = { ...e }\n        if (tmp.children && tmp.children.length > 0) {\n          tmp.children = this.doProcessDept(tmp.children)\n        } else {\n          tmp.children = undefined\n        }\n        res.push(tmp)\n      })\n      return res\n    },\n    // treeselect().then(response => {\n    //   this.deptOptions = response.data\n    // })\n    // },\n    // 筛选节点\n    getPostInfo() {\n      this.form.postIds = []\n      this.form.postIds.push(this.postId)\n    },\n    filterNode(value, data) {\n      if (!value) return true\n      return data.label.indexOf(value) !== -1\n    },\n    // 节点单击事件\n    handleNodeClick(data) {\n      if (data.parentId !== '0') {\n        this.queryParams.deptId = data.id\n      } else {\n        this.queryParams.deptId = ''\n      }\n      this.getList()\n    },\n    // 用户状态修改\n    handleStatusChange(row) {\n      const text = row.status === '0' ? '启用' : '停用'\n      this.$confirm('确认要\"' + text + '\"\"' + row.userName + '\"用户吗?', '警告', {\n        confirmButtonText: '确定',\n        cancelButtonText: '取消',\n        type: 'warning'\n      }).then(function() {\n        return changeUserStatus(row.userId, row.status)\n      }).then(() => {\n        this.msgSuccess(text + '成功')\n      }).catch(function() {\n        row.status = row.status === '0' ? '1' : '0'\n      })\n    },\n    // 取消按钮\n    cancel() {\n      this.open = false\n      this.reset()\n    },\n    // 表单重置\n    reset() {\n      this.form = {\n        userId: undefined,\n        deptId: undefined,\n        empCode: '',\n        empName: '',\n        phonenumber: '',\n        email: '',\n        sex: '',\n        status: '0',\n        isAppLogin: '0',\n        appRoles: [],\n        remark: '',\n        postIds: [],\n        roleIds: []\n      }\n      this.resetForm('form')\n    },\n    /** 搜索按钮操作 */\n    handleQuery() {\n      this.queryParams.pageNumber = 1\n      this.getList()\n    },\n    /** 重置按钮操作 */\n    resetQuery() {\n      this.dateRange = []\n      this.resetForm('queryForm')\n      this.handleQuery()\n    },\n    // 多选框选中数据\n    handleSelectionChange(selection) {\n      this.ids = selection.map(item => item.userId)\n      this.single = selection.length !== 1\n      this.multiple = !selection.length\n    },\n    // 更多操作触发\n    handleCommand(command, row) {\n      switch (command) {\n        case 'handleResetPwd':\n          this.handleResetPwd(row)\n          break\n        case 'handleAuthRole':\n          this.handleAuthRole(row)\n          break\n        default:\n          break\n      }\n    },\n    /** 新增按钮操作 */\n    handleAdd() {\n      this.reset()\n      this.open = true\n      this.title = '添加员工信息'\n    },\n    getPostAndRoleList() {\n      selectPostAll().then(res => {\n        this.postOptions = res.result || []\n      })\n      getAllRole().then(res => {\n        this.roleOptions = res.result || []\n      })\n    },\n    /** 修改按钮操作 */\n    handleUpdate(row) {\n      this.reset()\n      this.getTreeselect()\n      const userId = row.userId\n      getUser(userId).then(res => {\n        this.form = res.result.user\n        this.postId = res.result.checkedPostIds && res.result.checkedPostIds.length > 0 ? res.result.checkedPostIds[0] : ''\n        this.$set(this.form, 'postIds', res.result.checkedPostIds)\n        this.$set(this.form, 'roleIds', res.result.checkedRoleIds)\n        this.$set(this.form, 'appRoles', res.result.appRoles)\n        this.$delete(this.form, 'loginIp')\n        this.$delete(this.form, 'organId')\n        this.$delete(this.form, 'password')\n        this.$delete(this.form, 'createTime')\n        this.$delete(this.form, 'avatarPath')\n        this.$delete(this.form, 'userType')\n        this.open = true\n        this.title = '修改员工信息'\n      })\n    },\n    /** 重置密码按钮操作 */\n    handleResetPwd(row) {\n      this.$confirm('是否确认重置用户为\"' + row.empName + '\"的密码?', '警告', {\n        confirmButtonText: '确定',\n        cancelButtonText: '取消',\n        type: 'warning'\n      }).then(({ value }) => {\n        resetOriganPassword(row.userId).then(response => {\n          this.msgSuccess('重置成功')\n        })\n      }).catch(() => {})\n    },\n    /** 分配角色操作 */\n    handleAuthRole: function(row) {\n      const userId = row.userId\n      this.$router.push('/auth/role/' + userId)\n    },\n    /** 提交按钮 */\n    submitForm: function() {\n      if (this.form.isAppLogin === '1' && this.form.appRoles.length === 0) {\n        this.msgErrot('小程序角色不能为空')\n        return\n      }\n      this.$refs['form'].validate(valid => {\n        if (valid) {\n          if (this.form.userId !== undefined) {\n            updateUser(this.form).then(response => {\n              this.msgSuccess('修改成功')\n              this.open = false\n              this.getList()\n            })\n          } else {\n            addUser(this.form).then(response => {\n              this.msgSuccess('新增成功')\n              this.open = false\n              this.getList()\n            })\n          }\n        }\n      })\n    },\n    /** 删除按钮操作 */\n    handleDelete(row) {\n      const userIds = row.userId\n      this.$confirm('是否确认注销用户为\"' + row.empName + '\"的数据项?', '警告', {\n        confirmButtonText: '确定',\n        cancelButtonText: '取消',\n        type: 'warning'\n      }).then(function() {\n        return invalidUserByUserId(userIds)\n      }).then(() => {\n        this.getList()\n        this.msgSuccess('注销成功')\n      }).catch(() => {})\n    },\n    /** 启用 */\n    handleOnline(row) {\n      const userIds = row.userId\n      this.$confirm('是否确认启用该账号', '警告', {\n        confirmButtonText: '确定',\n        cancelButtonText: '取消',\n        type: 'warning'\n      }).then(function() {\n        return onlineUserByUserId(userIds)\n      }).then(() => {\n        this.getList()\n        this.msgSuccess('注销成功')\n      }).catch(() => {})\n    },\n    switchChange() {\n      if (this.form.isAppLogin === '0') this.form.appRoles = []\n    },\n\n    handleDownload() {\n      const url = this.$store.getters.sysBaseUrl + '/api/dataImport/exportEmployee'\n      window.open(url)\n    },\n\n    downloadTem() {\n      const url = this.$store.getters.sysBaseUrl + '/api/dataImport/downloadEmployeeExcel'\n      window.open(url)\n    },\n    uploadChange(file) {\n      if (file.status === 'ready') return\n      if (file.status === 'success') {\n        const res = file.response || {}\n        if (res && res.code === 200) {\n          this.fileResult = file.response.result\n          this.$message({\n            type: 'success',\n            message: file.response.message\n          })\n          this.handleQuery()\n          this.uploadVisible = false\n        } else {\n          this.$message.error('上传失败!')\n          this.excelFileList = []\n        }\n      } else {\n        this.$message.error('上传失败!')\n        this.excelFileList = []\n      }\n    },\n    handleUpload() {\n      this.uploadVisible = true\n      this.excelFileList = []\n    }\n\n  }\n}\n</script>\n\n<style scoped lang=\"scss\" type=\"text/scss\">\n  .time-dot {\n    text-align: center;\n    justify-content: center;\n    padding-top: 4px;\n    position: relative;\n    border-radius: 50%;\n    background: #dfe4ed;\n    height: 25px;\n    width: 25px;\n    left: -7px;\n  }\n  </style>\n"]}]}